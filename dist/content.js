(()=>{var a=(...t)=>console.log(...t),p=(...t)=>console.error(...t),N=t=>["P","SPAN","A","H1","H2","H3","H4","H5","H6","DIV","YT-ATTRIBUTED-STRING"].includes(t.tagName),d=t=>t?.innerText?.trim(),m=t=>t?.split(/\s+/).length>=2,B=t=>t.getAttribute("lang")==="en",E=t=>{let o=t?.tagName,n=d(t),e=location.hostname.includes("twitter")||location.hostname.includes("x.com"),c=n&&N(t)&&(!e||B(t))&&m(n)&&!t.hasAttribute("data-score");return a(c?"\u2705 Valid:":"\u274C Skipped:",`[${o}]`,n),c};var M="https://medoxz543-hate-endpoint.hf.space/check-text",w=10,_=200,b=new Map,g=new Map;async function u(t){let o=[];if(t.forEach(n=>{let e=d(n);if(!(!e||!E(n))){if(b.has(e)||b.set(e,[]),b.get(e).push(n),g.has(e)){let{blur:c,score:r}=g.get(e);c&&T(n,r);return}o.push(e)}}),!!o.length)for(let n=0;n<o.length;n+=w){let e=o.slice(n,n+w),c=Date.now();a("%c\u{1F4E4} Sending batch to server:","color: green; font-weight: bold;",e);try{let r=await fetch(M,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({texts:e})});if(!r.ok){p(`\u274C Server error ${r.status} \u2013 ${r.statusText}`),p(await r.text());continue}let{results:s=[],db_logged:i}=await r.json();a(`\u{1F4E1} API response (${e.length}) ${Date.now()-c} ms`),i!==void 0&&a("\u{1F4C4} DB logging status:",i),s.forEach(({blur:l,score:h},I)=>{let x=e[I];g.set(x,{blur:l,score:h}),l&&(b.get(x)||[]).forEach(D=>T(D,h))})}catch(r){p("\u{1F525} Fetch failed:",r)}await C(_)}}function T(t,o){t.classList.add("ai-blur"),t.setAttribute("title",`Blurred by AI \u{1F6E1}\uFE0F (Score: ${o.toFixed(2)})`),t.dataset.blurred="true",t.dataset.score=o}function C(t){return new Promise(o=>setTimeout(o,t))}function y(){a("\u{1F4FA} YouTube scan activated");let t=r=>{let s=r.querySelector("#content-text");return s?.querySelector("yt-attributed-string")||s},o=(r,s)=>{let i=t(r);i&&m(d(i))&&s.push(i)},n=()=>{let r=[];document.querySelectorAll("ytd-comment-thread-renderer").forEach(s=>{o(s,r)}),u(r)},e=r=>{let s=[];r.forEach(i=>{i.addedNodes.forEach(l=>{l.nodeType===Node.ELEMENT_NODE&&(l.matches?.("ytd-comment-thread-renderer")?o(l,s):l.querySelectorAll?.("ytd-comment-thread-renderer")?.forEach(h=>{o(h,s)}))})}),s.length>0&&(a("\u{1F440} New dynamic YT comments:",s.length),u(s))},c=new MutationObserver(e);n(),c.observe(document.body,{childList:!0,subtree:!0})}function f(){a("\u{1F426} Twitter scan activated");let t=()=>{let n=[];document.querySelectorAll('[data-testid="cellInnerDiv"]').forEach(e=>{e.querySelectorAll('[data-testid="tweetText"]').forEach(c=>{isEnglish(c)&&m(d(c))&&n.push(c)})}),u(n)},o=new MutationObserver(n=>{let e=[];n.forEach(c=>{c.addedNodes.forEach(r=>{r.nodeType===1&&(r.matches?.('[data-testid="cellInnerDiv"]')?e.push(...r.querySelectorAll('[data-testid="tweetText"], div[lang="en"]')):r.querySelectorAll?.('[data-testid="cellInnerDiv"]')?.forEach(s=>{e.push(...s.querySelectorAll('[data-testid="tweetText"], div[lang="en"]'))}))})}),e.length>0&&(a("\u{1F440} New dynamic tweets:",e.length),u(e))});t(),o.observe(document.body,{childList:!0,subtree:!0})}var O={"x.com":f,"twitter.com":f,"youtube.com":y},S=location.hostname.replace(/^www\./,""),v=O[S],A=localStorage.getItem("blurEnabled");window.blurEnabled=A===null?!0:A!=="false";v?(P(),v()):a("\u{1F310} No scanner defined for this domain:",S);function P(){let t=()=>{if(!document.body){requestAnimationFrame(t);return}console.log("\u{1F7E2} Attempting to inject toggle button...");let o=document.createElement("button");o.id="blur-toggle-btn",o.textContent=window.blurEnabled?"\u{1F6E1}\uFE0F Blur: ON":"\u{1F6E1}\uFE0F Blur: OFF",o.addEventListener("click",()=>{window.blurEnabled=!window.blurEnabled,localStorage.setItem("blurEnabled",window.blurEnabled),o.textContent=window.blurEnabled?"\u{1F6E1}\uFE0F Blur: ON":"\u{1F6E1}\uFE0F Blur: OFF",document.querySelectorAll("[data-blurred='true']").forEach(n=>{window.blurEnabled?n.classList.add("ai-blur"):n.classList.remove("ai-blur")})}),document.body.appendChild(o),console.log("\u2705 Toggle button injected.")};t()}})();
